<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Detail Mahasiswa - {{ mahasiswa.nama }}</title>
    <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    >
</head>
<body class="bg-light">
<div class="container my-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="mb-0">Detail Mahasiswa</h1>
        <div>
            <a href="{% url 'portal:dosen_dashboard' %}" class="btn btn-secondary btn-sm me-2">
                &larr; Kembali ke Dashboard
            </a>
            <a href="{% url 'portal:logout' %}" class="btn btn-outline-secondary btn-sm">
                Logout
            </a>
        </div>
    </div>
    <hr>

    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}
    

    <!-- Profil Mahasiswa -->
    <div class="card mb-4">
        <div class="card-body">
            <h3 class="card-title mb-2">{{ mahasiswa.nama }}</h3>
            <p class="mb-1">
                <strong>NIM:</strong> {{ mahasiswa.nim }}<br>
                <strong>Angkatan:</strong> {{ mahasiswa.angkatan }}<br>
                <strong>Status PKL:</strong> {{ mahasiswa.get_status_pkl_display }}<br>
                <strong>Email:</strong> {{ mahasiswa.email|default:"-" }}<br>
                <strong>No. HP:</strong> {{ mahasiswa.no_hp|default:"-" }}
            </p>
            <p class="mb-0">
                <strong>Mitra:</strong>
                {% if mahasiswa.mitra %}
                    {{ mahasiswa.mitra.nama }} ({{ mahasiswa.mitra.kota|default:"" }})
                {% else %}
                    -
                {% endif %}
                <br>
                <strong>Periode:</strong>
                {% if mahasiswa.periode %}
                    {{ mahasiswa.periode.nama_periode }} ({{ mahasiswa.periode.tahun_ajaran }})
                {% else %}
                    -
                {% endif %}
            </p>
        </div>
    </div>

    <div class="row">
        <!-- Logbook -->
        <div class="col-md-6 mb-4">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="mb-0">Logbook</h5>
                </div>
                <div class="card-body p-0">
                    {% if logbooks %}
                        <div class="table-responsive">
                            <table class="table table-striped table-hover mb-0">
                                <thead>
                                    <tr>
                                        <th>Tanggal</th>
                                        <th>Jam</th>
                                        <th>Status</th>
                                        <th>Aktivitas</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for entry in logbooks %}
                                        <tr>
                                            <td>{{ entry.tanggal }}</td>
                                            <td>
                                                {{ entry.jam_mulai|default:"-" }} - {{ entry.jam_selesai|default:"-" }}
                                            </td>
                                            <td>{{ entry.get_status_display }}</td>
                                            <td>{{ entry.aktivitas|truncatechars:80 }}</td>
                                            <td>
                                                <a href="{% url 'portal:dosen_logbook_review' entry.id %}"
                                                class="btn btn-sm btn-outline-primary">
                                                    Review
                                                </a>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <p class="p-3 mb-0">Belum ada entri logbook.</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Bimbingan -->
        <div class="col-md-6 mb-4">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="mb-0">Sesi Bimbingan</h5>
                </div>
                <div class="card-body p-0">
                    {% if guidances %}
                        <div class="table-responsive">
                            <table class="table table-striped table-hover mb-0">
                                <thead>
                                    <tr>
                                        <th>Tanggal</th>
                                        <th>Pertemuan</th>
                                        <th>Metode</th>
                                        <th>Status</th>
                                        <th>Topik</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for sess in guidances %}
                                        <tr>
                                            <td>{{ sess.tanggal }}</td>
                                            <td>{{ sess.pertemuan_ke|default:"-" }}</td>
                                            <td>{{ sess.get_metode_display }}</td>
                                            <td>{{ sess.get_status_display }}</td>
                                            <td>{{ sess.topik|truncatechars:80 }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <p class="p-3 mb-0">Belum ada sesi bimbingan.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    <!-- Form Tambah Sesi Bimbingan -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">Tambah Sesi Bimbingan</h5>
        </div>
        <div class="card-body">
            <form method="post">
                {% csrf_token %}
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label class="form-label" for="{{ form.tanggal.id_for_label }}">Tanggal</label>
                        {{ form.tanggal }}
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label" for="{{ form.pertemuan_ke.id_for_label }}">Pertemuan ke-</label>
                        {{ form.pertemuan_ke }}
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label" for="{{ form.metode.id_for_label }}">Metode</label>
                        {{ form.metode }}
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label class="form-label" for="{{ form.jam_mulai.id_for_label }}">Jam mulai</label>
                        {{ form.jam_mulai }}
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label" for="{{ form.jam_selesai.id_for_label }}">Jam selesai</label>
                        {{ form.jam_selesai }}
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label" for="{{ form.platform.id_for_label }}">Platform/Ruang</label>
                        {{ form.platform }}
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label" for="{{ form.topik.id_for_label }}">Topik</label>
                    {{ form.topik }}
                </div>

                <div class="mb-3">
                    <label class="form-label" for="{{ form.ringkasan_diskusi.id_for_label }}">Ringkasan diskusi</label>
                    {{ form.ringkasan_diskusi }}
                </div>

                <div class="mb-3">
                    <label class="form-label" for="{{ form.tindak_lanjut.id_for_label }}">Tindak lanjut / tugas</label>
                    {{ form.tindak_lanjut }}
                </div>

                <div class="mb-3">
                    <label class="form-label" for="{{ form.status.id_for_label }}">Status</label>
                    {{ form.status }}
                </div>

                <button type="submit" class="btn btn-primary">
                    Simpan sesi bimbingan
                </button>
            </form>
        </div>
    </div>
    
</div>
</body>
</html>