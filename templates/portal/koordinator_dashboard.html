{% extends "portal/base.html" %}

{% block title %}Dashboard Koordinator PKL - PKL Sains Data{% endblock %}

{% block content %}
<div class="row mb-4">
  <div class="col">
    <h1 class="h3 fw-bold mb-1">
      Dashboard Koordinator PKL
    </h1>
    <p class="text-muted mb-0">
      Hai, {{ koordinator.nama|default:"Koordinator" }}. Berikut ringkasan program PKL di prodi Anda.
    </p>
  </div>
</div>

<!-- Ringkasan utama -->
<div class="row g-3 mb-4">
  <!-- Total Mahasiswa -->
  <div class="col-md-3">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-body">
        <div class="text-uppercase text-muted small fw-semibold mb-1">
          Total Mahasiswa
        </div>
        <div class="display-6 fw-bold">
          {{ total_mahasiswa|default:0 }}
        </div>
        <p class="small text-muted mb-0">
          Mahasiswa yang terdaftar dalam sistem PKL.
        </p>
      </div>
    </div>
  </div>

  <!-- Total Mitra -->
  <div class="col-md-3">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-body">
        <div class="text-uppercase text-muted small fw-semibold mb-1">
          Total Mitra
        </div>
        <div class="display-6 fw-bold">
          {{ total_mitra|default:0 }}
        </div>
        <p class="small text-muted mb-0">
          Perusahaan / instansi yang bekerja sama untuk PKL.
        </p>
      </div>
    </div>
  </div>

  <!-- Pendaftaran PKL -->
  <div class="col-md-3">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-body">
        <div class="text-uppercase text-muted small fw-semibold mb-1">
          Pendaftaran PKL
        </div>
        <div class="display-6 fw-bold">
          {{ total_pendaftaran|default:0 }}
        </div>
        <ul class="list-unstyled small text-muted mb-0 mt-2">
          <li>
            <span class="badge bg-warning text-dark me-1">Dikirim</span>
            {{ total_pendaftaran_dikirim|default:0 }}
          </li>
          <li>
            <span class="badge bg-success me-1">Disetujui</span>
            {{ total_pendaftaran_disetujui|default:0 }}
          </li>
          <li>
            <span class="badge bg-danger me-1">Ditolak</span>
            {{ total_pendaftaran_ditolak|default:0 }}
          </li>
        </ul>
        <div class="mt-3">
          <a href="{% url 'portal:koordinator_pendaftaran_list' %}" class="btn btn-sm btn-outline-primary">
            Kelola Pendaftaran
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Seminar Hasil PKL -->
  <div class="col-md-3">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-body">
        <div class="text-uppercase text-muted small fw-semibold mb-1">
          Seminar Hasil PKL
        </div>
        <div class="display-6 fw-bold">
          {{ total_seminar_dikirim|add:total_seminar_dijadwalkan|add:total_seminar_selesai }}
        </div>
        <ul class="list-unstyled small text-muted mb-0 mt-2">
          <li>
            <span class="badge bg-warning text-dark me-1">Dikirim</span>
            {{ total_seminar_dikirim|default:0 }}
          </li>
          <li>
            <span class="badge bg-info text-dark me-1">Dijadwalkan</span>
            {{ total_seminar_dijadwalkan|default:0 }}
          </li>
          <li>
            <span class="badge bg-success me-1">Selesai</span>
            {{ total_seminar_selesai|default:0 }}
          </li>
        </ul>
        <div class="mt-3">
          <a href="{% url 'portal:koordinator_seminar_list' %}" class="btn btn-sm btn-outline-primary">
            Kelola Seminar
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Tabel pendaftaran & seminar terbaru -->
<div class="row g-3">
  <!-- Pendaftaran PKL terbaru -->
  <div class="col-lg-6">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-header bg-white border-0 d-flex justify-content-between align-items-center">
        <h2 class="h6 mb-0">Pendaftaran PKL Terbaru</h2>
        <a href="{% url 'portal:koordinator_pendaftaran_list' %}" class="btn btn-sm btn-outline-secondary">
          Lihat Semua
        </a>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-sm mb-0 align-middle">
            <thead class="table-light">
              <tr>
                <th>NIM</th>
                <th>Nama</th>
                <th>Mitra</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              {% for p in recent_pendaftaran %}
                <tr>
                  <td>{{ p.mahasiswa.nim }}</td>
                  <td class="small">{{ p.mahasiswa.nama }}</td>
                  <td class="small">
                    {{ p.mitra.nama|default:"-" }}
                  </td>
                  <td>
                    <span class="badge
                      {% if p.status == 'DISETUJUI' %} bg-success
                      {% elif p.status == 'DIKIRIM' %} bg-warning text-dark
                      {% elif p.status == 'DITOLAK' %} bg-danger
                      {% else %} bg-secondary
                      {% endif %}
                    ">
                      {{ p.get_status_display }}
                    </span>
                  </td>
                </tr>
              {% empty %}
                <tr>
                  <td colspan="4" class="text-center text-muted small py-3">
                    Belum ada pendaftaran PKL terbaru.
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Seminar terbaru -->
  <div class="col-lg-6">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-header bg-white border-0 d-flex justify-content-between align-items-center">
        <h2 class="h6 mb-0">Seminar Hasil PKL Terbaru</h2>
        <a href="{% url 'portal:koordinator_seminar_list' %}" class="btn btn-sm btn-outline-secondary">
          Lihat Semua
        </a>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-sm mb-0 align-middle">
            <thead class="table-light">
              <tr>
                <th>NIM</th>
                <th>Nama</th>
                <th>Jadwal</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              {% for s in recent_seminar %}
                <tr>
                  <td>{{ s.mahasiswa.nim }}</td>
                  <td class="small">{{ s.mahasiswa.nama }}</td>
                  <td class="small">
                    {% if s.jadwal %}
                      {{ s.jadwal|date:"d M Y H:i" }}
                    {% else %}
                      <span class="text-muted">Belum dijadwalkan</span>
                    {% endif %}
                  </td>
                  <td>
                    <span class="badge
                      {% if s.status == 'SELESAI' %} bg-success
                      {% elif s.status == 'DIJADWALKAN' %} bg-info text-dark
                      {% elif s.status == 'DIKIRIM' %} bg-warning text-dark
                      {% elif s.status == 'DITOLAK' %} bg-danger
                      {% else %} bg-secondary
                      {% endif %}
                    ">
                      {{ s.get_status_display }}
                    </span>
                  </td>
                </tr>
              {% empty %}
                <tr>
                  <td colspan="4" class="text-center text-muted small py-3">
                    Belum ada data seminar terbaru.
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
